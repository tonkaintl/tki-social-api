# TKI Social API - System Architecture

**Domain**: `socialapi.tonkaintl.com`  
**Stack**: Node.js + Express + JavaScript + MongoDB  
**Database**: `tki-social`

## System Overview

The TKI Social API is a campaign-based social media management system that generates platform-specific content dynamically from vehicle inventory data. Instead of storing formatted content, the system creates fresh, optimized posts for each social platform when needed.

## Core Architecture Flow

### 1. Campaign Creation

- User selects a vehicle (stock number) from inventory
- System fetches fresh data from Binder service
- Creates campaign record in MongoDB with basic info + media portfolio
- No platform-specific content is stored - generated on-demand

### 2. Preview System

- User requests preview for specific platform (LinkedIn, Meta, X, Reddit)
- System uses platform adapters to generate formatted content
- Returns preview without saving to database
- Each platform has unique formatting (professional LinkedIn vs engaging Meta)

### 3. Media Portfolio

- Each campaign maintains a `media_urls` collection
- Users can add/remove images, videos, PDFs
- Portfolio is separate from Binder media - user curated
- Only images/videos used for social posting (PDFs excluded)

### 4. Campaign-Based Posting

- User clicks "Post to LinkedIn" (or other platform)
- System generates fresh content using platform adapter
- Includes campaign media from portfolio
- Makes real API call to social platform
- Returns success/failure with platform response

## Platform Adapters

### Adapter Pattern

Each social platform has its own adapter that handles:

- **Content Generation**: Platform-specific formatting and tone
- **API Integration**: Direct posting to platform APIs
- **Error Handling**: Graceful failures for unconfigured platforms

### Current Adapters

**LinkedIn Adapter:**

- Professional tone content
- Business-focused formatting
- Real API integration with LinkedIn

**Meta Adapter:**

- Engaging content with emojis
- Facebook-optimized formatting
- Real API integration with Facebook

**X (Twitter) Adapter:**

- Concise, hashtag-optimized content
- Character limit awareness
- Graceful failure: "X/Twitter API credentials not configured"

**Reddit Adapter:**

- Community-appropriate formatting
- Markdown-style content
- Graceful failure: "Reddit API credentials not configured"

## Services Layer

### Binder Service

- Fetches fresh inventory data by stock number
- Normalizes vehicle data (make, model, year, price, etc.)
- Provides media URLs from inventory system

### Campaign Service

- CRUD operations for campaigns
- Status tracking (draft, published, failed)
- Media portfolio management

### Portal Service

- Authentication with external systems
- API client for Portal endpoints

## Database Design

### Campaign Collection

```javascript
{
  _id: ObjectId,
  stock_number: "21001",
  title: "2018 Chevrolet Silverado",
  description: "Reliable work truck...",
  status: "draft",
  created_by: "user@tonkaintl.com",
  created_at: Date,
  updated_at: Date,

  // Media Portfolio - user curated
  media_urls: [
    {
      url: "https://example.com/image1.jpg",
      media_type: "image",
      description: "Front view"
    }
  ],

  // Dynamic data (fetched fresh, not stored):
  // - binder_data: Vehicle specs from Binder
  // - platform_content: Generated by adapters
}
```

## Authentication & Security

- **Bearer Token**: OAuth2 via Microsoft Entra ID
- **Internal Secret**: x-internal-secret header for service calls
- **Rate Limiting**: Prevents API abuse
- **CORS**: Configured for TKI domains

## Future Integrations

### Metricool Integration (Planned)

- Schedule posts in Metricool dashboard
- Sync posting status between systems
- Bulk operations for multiple platforms

### Direct Posting (Planned)

- Immediate posting without campaign workflow
- Multi-platform batch posting
- Manual post tracking

## Error Handling Philosophy

- **200 Status**: Success and graceful failures (platform not configured)
- **500 Status**: Only for real API errors or system failures
- **Clear Messages**: "API credentials not configured" vs generic errors
- **Graceful Degradation**: System works even if some platforms unavailable

## Key Benefits

1. **Dynamic Content**: Always fresh, never stale cached content
2. **Platform Optimization**: Each platform gets tailored formatting
3. **Single Source**: Binder data remains the source of truth
4. **Flexible Media**: User-curated portfolio separate from inventory images
5. **Real Integration**: Actual API calls to social platforms
6. **Scalable**: Easy to add new platforms with adapter pattern

---

This architecture supports the full campaign lifecycle from creation through posting while maintaining flexibility and real-time data accuracy.
