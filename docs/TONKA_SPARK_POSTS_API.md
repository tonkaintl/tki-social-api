# Tonka Spark Posts API

Full blog posts generated by n8n WritersRoom workflow from TonkaSparks seed ideas.

## What Changed from Writers Room Entries

- **Endpoint**: `/api/writers-room-entries` → `/api/tonka-spark-post`
- **Collection**: `writers_room_entries` → `tonka_spark_posts`
- **Model**: WritersRoomEntry → TonkaSparkPosts

Data structure and authentication remain the same.

---

## Endpoints

### GET /api/tonka-spark-post

List posts with filtering and pagination.

**Auth**: Bearer token required

**Query params**:

- `page` (default: 1)
- `limit` (default: 50, max: 100)
- `status` - `draft`, `sent`, `published`, `archived`
- `brand` - `tonka_blog`, `tonka_intl`, etc.
- `mode` - `blog_post`, `social_post`, `email`, etc.
- `sortBy` - `created_at`, `updated_at`, `status` (default: `created_at`)
- `sortOrder` - `asc` or `desc` (default: `desc`)
- `search` - Search in title and notifier_email

**Response**:

```json
{
  "content": [],
  "count": 25,
  "pagination": {
    "currentPage": 1,
    "limit": 50,
    "totalCount": 150,
    "totalPages": 3
  },
  "filters": {
    "status": "draft",
    "brand": "tonka_blog",
    "mode": null
  },
  "requestId": "abc123"
}
```

### GET /api/tonka-spark-post/:id

Get single post by `content_id` (UUID) or `_id` (MongoDB ObjectId).

**Auth**: Bearer token required

**Response**: Full post object with all fields

**Error codes**:

- `404` - Post not found
- `500` - Internal error

---

## Visual Prompt Image Management

### POST /api/tonka-spark-post/:id/visual-prompts/:promptId/images

Add generated image to a visual prompt.

**Auth**: Bearer token required

**Body**:

```json
{
  "imageUrl": "https://...",
  "alt": "Description",
  "description": "...",
  "filename": "image.png",
  "size": 1024000
}
```

### DELETE /api/tonka-spark-post/:id/visual-prompts/:promptId/images/:imageUrl

Remove image from visual prompt. The `imageUrl` param should be URL-encoded.

**Auth**: Bearer token required

---

## Key Fields

- `content_id` - UUID identifier (use this for API calls)
- `status` - Current state of the post
- `final_draft.title` - Post title
- `final_draft.draft_markdown` - Full article content in Markdown
- `visual_prompts[]` - Array of AI image generation prompts
- `outputs.gdocs_folder_id` - Google Drive folder ID
- `notifier_email` - Email for notifications
- `project.brand` - Brand slug
- `project_mode` - Content mode

---

## Frontend Migration Checklist

- [ ] Update API base path: `/api/writers-room-entries` → `/api/tonka-spark-post`
- [ ] Update any hardcoded collection references
- [ ] Test list endpoint with existing filters
- [ ] Test single post retrieval
- [ ] Verify visual prompt endpoints work
- [ ] Update error handling for new error codes

All data structures remain identical - only the endpoint paths changed.
