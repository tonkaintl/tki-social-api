# Writers Room Content API - Frontend Documentation

## Overview

The Writers Room Content API provides endpoints for managing AI-generated multi-LLM content for social media and blog posts. This content is generated by the n8n Writers Room workflow and includes drafts, story arcs, research, visual prompts, and platform-specific summaries.

---

## Authentication

All endpoints require **Bearer Token authentication** via Azure AD.

```
Authorization: Bearer <your_token>
```

Webhook endpoints (for n8n) require `x-internal-secret` header instead.

---

## Endpoints

### 1. List Writers Room Content

**GET** `/api/writers-room-content`

Retrieve a paginated list of Writers Room content with optional filtering.

#### Query Parameters

| Parameter   | Type   | Required | Default      | Description                                 |
| ----------- | ------ | -------- | ------------ | ------------------------------------------- |
| `page`      | number | No       | 1            | Page number (1-indexed)                     |
| `limit`     | number | No       | 50           | Items per page (1-100)                      |
| `sortBy`    | string | No       | `created_at` | Field to sort by                            |
| `sortOrder` | string | No       | `desc`       | Sort direction: `asc` or `desc`             |
| `status`    | string | No       | -            | Filter by status: `draft`, `sent`, `failed` |
| `brand`     | string | No       | -            | Filter by brand (see Brand List below)      |
| `mode`      | string | No       | -            | Filter by mode (see Platform Modes below)   |

#### Response

```json
{
  "contents": [
    {
      "_id": "6940a36887e77739dd413280",
      "content_id": "wrc_1765843816493_tonka_blog",
      "status": "sent",
      "project_mode": "blog_post",
      "project": {
        "brand": "tonka_blog",
        "mode": "blog_post",
        "audience": "truck buyers who are cautious...",
        "brand_meta": {
          "name": "Tonka Blog",
          "slug": "tonka_blog",
          "tagline": "Dispatches from the iron business.",
          "voice": "Straight-talking broker, reflective but practical",
          "guidelines": {
            /* ... */
          }
        }
      },
      "final_draft": {
        "title": "Patience Pays: How to Avoid the Mousetrap in Used Truck Deals",
        "thesis": "In the used Class 8 truck market...",
        "summary": "This Tonka Blog post reminds...",
        "draft_markdown": "Everyone loves free cheese...",
        "role": "Head Writer"
      },
      "title_variations": [
        "Avoiding the Mousetrap: A Patient Approach...",
        "Why Patience Is Your Best Tool..."
        /* ... */
      ],
      "platform_summaries": {
        "youtube": "Discover how patience and thorough inspections...",
        "linkedin": "For professionals in trucking...",
        "x": "Buying a used Class 8 truck?...",
        "meta": "Used Class 8 truck buyers: avoid rushed deals...",
        "tonkaintl": "Tonka Blog shares essential inspection steps..."
      },
      "future_story_arc_generator": {
        "arcs": [
          {
            "arc_title": "Buying in Bulk: How Fleet Purchases Multiply Risk",
            "one_line_premise": "When scaling a small fleet...",
            "why_it_matters": "A single bad truck is costly...",
            "suggested_story_seed": "Practical checklist for multi-truck buys..."
          }
          /* ... 2 more arcs ... */
        ]
      },
      "visual_prompts": [
        {
          "id": "vp-01",
          "intent": "hero",
          "prompt": "Wide, steady still of a used Class 8 tractor..."
        }
        /* ... 4 more prompts ... */
      ],
      "research": {
        "enable_research": true,
        "facts": "Most buyers do not take time to fully inspect...",
        "findings": [
          "DOT Level 1 North American Standard Inspection checks..."
          /* ... */
        ],
        "sources": [
          "https://schneiderjobs.com/blog/pre-trip-inspection"
          /* ... */
        ],
        "citations": [
          /* ... */
        ]
      },
      "writer_notes": {
        "action": {
          "role": "action",
          "weight": 0.2,
          "notes": [
            "Buyer spots a gleaming truck deal..."
            /* ... */
          ]
        },
        "comedy": {
          "role": "comedy",
          "weight": 0.1,
          "notes": [
            "Everyone loves a bargain until..."
            /* ... */
          ]
        }
      },
      "writer_panel": [
        { "role": "comedy", "weight": 0.1 },
        { "role": "documentary", "weight": 0.7 },
        { "role": "action", "weight": 0.2 }
      ],
      "creative": {
        "creativity_to_reporter": 90,
        "fact_to_fiction": 15,
        "tone_strictness": 30,
        "length": "short"
      },
      "outputs": {
        "blog_post": true,
        "future_story_arc": true,
        "visual_prompts": true,
        "mongo_log": true,
        "gdocs_folder_id": "1EFwmu8YdaRT-yGGGm1kFv_8DIcVZ07re"
      },
      "notifier_email": "user@example.com",
      "created_at": "2025-12-15T23:50:16.493Z",
      "updated_at": "2025-12-15T23:50:16.520Z",
      "email_sent_at": "2025-12-15T23:50:16.520Z"
    }
    /* ... more content items ... */
  ],
  "pagination": {
    "current_page": 1,
    "total_pages": 5,
    "total_items": 234,
    "limit": 50,
    "has_next_page": true,
    "has_prev_page": false
  }
}
```

---

### 2. Get Writers Room Content by ID

**GET** `/api/writers-room-content/:id`

Retrieve a single Writers Room content item by its `content_id`.

#### Path Parameters

| Parameter | Type   | Required | Description                                           |
| --------- | ------ | -------- | ----------------------------------------------------- |
| `id`      | string | Yes      | The content_id (e.g., `wrc_1765843816493_tonka_blog`) |

#### Response

Returns a single content object with the same structure as list items (see above).

#### Error Responses

**404 Not Found**

```json
{
  "code": "NOT_FOUND",
  "error": "Writers Room content not found: wrc_invalid_id"
}
```

---

### 3. Webhook - Receive Writers Room Content

**POST** `/api/webhooks/writers-room/content`

Internal webhook endpoint for n8n to submit generated content.

#### Authentication

Requires `x-internal-secret` header (not Bearer token).

```
x-internal-secret: <n8n_internal_secret>
```

#### Request Body

Full Writers Room content object (same structure as GET response).

Required fields:

- `notifier_email` - Email to notify when content is received
- `send_email` (optional) - Whether to send notification email (default: true)

#### Response

```json
{
  "content_id": "wrc_1765843816493_tonka_blog",
  "documentId": "6940a36887e77739dd413280",
  "status": "sent",
  "notifier_email": "user@example.com"
}
```

---

## Data Structure Reference

### Brand List

Available values for `project.brand`:

- `diesel_kings`
- `echoloop`
- `generic_brand`
- `ketosis_lifestyle_project`
- `purple_star`
- `theater_404`
- `tonka_blog`
- `tonka_newsletter`

### Platform Modes

Available values for `project_mode`:

- `blog_post` - Blog post format
- `future_story_arc` - Story arc suggestions
- `mixed_allegory` - Mixed allegory style
- `novella_chapter` - Novella chapter format
- `reference_doc` - Reference documentation
- `screenplay` - Screenplay format
- `social_post` - Social media post
- `story_prompts` - Story prompt generation
- `straight_ad` - Direct advertisement
- `visual_prompts` - Visual prompt generation

### Writing Genres

Inferred by Genre Tone Router:

- `Action`
- `Biography`
- `Comedy`
- `Documentary`
- `Historic`
- `Research`
- `SciFi`

### Content Status

- `draft` - Content is being drafted
- `sent` - Content successfully saved and notification sent
- `failed` - Processing failed

---

## TypeScript Interfaces

```typescript
interface WritersRoomContent {
  _id: string;
  content_id: string;
  status: 'draft' | 'sent' | 'failed';
  project_mode: string;

  project: {
    brand: string;
    mode: string;
    audience?: string;
    brand_meta?: {
      name: string;
      slug: string;
      tagline: string;
      voice: string;
      guidelines?: {
        do?: string[];
        dont?: string[];
        style_examples?: string[];
      };
    };
  };

  final_draft?: {
    title: string;
    thesis?: string;
    summary?: string;
    draft_markdown: string;
    role: string;
  };

  title_variations?: string[];

  platform_summaries?: {
    youtube?: string;
    linkedin?: string;
    x?: string;
    meta?: string;
    tonkaintl?: string;
  };

  future_story_arc_generator?: {
    arcs: Array<{
      arc_title: string;
      one_line_premise: string;
      why_it_matters: string;
      suggested_story_seed: string;
    }>;
  };

  visual_prompts?: Array<{
    id: string;
    intent: string;
    prompt: string;
  }>;

  research?: {
    enable_research: boolean;
    facts?: string;
    findings?: string[];
    sources?: string[];
    citations?: string[];
  };

  writer_notes?: {
    [genre: string]: {
      role: string;
      weight: number;
      notes: string[];
    };
  };

  writer_panel?: Array<{
    role: string;
    weight: number;
  }>;

  creative?: {
    creativity_to_reporter: number;
    fact_to_fiction: number;
    tone_strictness: number;
    length: string;
  };

  outputs?: {
    blog_post?: boolean;
    future_story_arc?: boolean;
    visual_prompts?: boolean;
    mongo_log?: boolean;
    gdocs_folder_id?: string;
  };

  notifier_email: string;
  created_at: string;
  updated_at: string;
  email_sent_at?: string;
}

interface PaginatedResponse {
  contents: WritersRoomContent[];
  pagination: {
    current_page: number;
    total_pages: number;
    total_items: number;
    limit: number;
    has_next_page: boolean;
    has_prev_page: boolean;
  };
}
```

---

## Usage Examples

### Fetch all blog posts for Tonka Blog

```javascript
const response = await fetch(
  '/api/writers-room-content?brand=tonka_blog&mode=blog_post&limit=25',
  {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  }
);

const { contents, pagination } = await response.json();
```

### Get specific content by ID

```javascript
const response = await fetch(
  '/api/writers-room-content/wrc_1765843816493_tonka_blog',
  {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  }
);

const content = await response.json();
```

### Filter by status and sort

```javascript
const response = await fetch(
  '/api/writers-room-content?status=sent&sortBy=updated_at&sortOrder=desc',
  {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  }
);
```

---

## Notes

- All timestamps are in ISO 8601 format (UTC)
- Content is stored in MongoDB collection: `writers_room_contents`
- Email notifications are sent via Azure Email Service
- Maximum page limit is 100 items
- All endpoints return proper error codes and messages
- The `gdocs_folder_id` in outputs points to Google Drive folder where final drafts are stored
